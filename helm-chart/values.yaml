# =========================================
# ConnectHub - Default Values
# =========================================
# This file contains default configuration values for the chart.
# Override these values using:
#   helm install my-release ./helm-chart -f custom-values.yaml
# Or:
#   helm install my-release ./helm-chart --set backend.replicas=3
# =========================================

# Global settings applied to all components
global:
  # Image pull secrets for private Docker Hub repos
  imagePullSecrets:
    - name: dockerhub-secret

# Backend API configuration
backend:
  enabled: true
  replicas: 2
  
  image:
    repository: tomernos/connecthub-backend
    tag: 1b46d09  # Update this with your latest image SHA
    pullPolicy: Always
  
  service:
    name: backend-api
    type: ClusterIP
    port: 5000
  
  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m
  
  # Environment configuration for backend
  env:
    # Flask application settings
    flaskApp: run.py
    flaskEnv: production
    
    # Database connection settings
    dbHost: postgres-service
    dbPort: 5432
    dbName: chatapp
    dbUser: chatuser
    
    # Redis connection settings
    redisHost: cache
    redisPort: 6379
    
    # RabbitMQ connection settings
    rabbitmqHost: message-queue
    rabbitmqPort: 5672
    rabbitmqUser: guest
  
  # ConfigMap configuration
  configMap:
    name: backend-config
    create: true

# Frontend configuration
frontend:
  enabled: true
  replicas: 2
  
  image:
    repository: tomernos/connecthub-frontend
    tag: 1b46d09  # Update this with your latest image SHA
    pullPolicy: Always
  
  service:
    name: frontend-service
    type: NodePort
    port: 80
    nodePort: 30080
  
  resources:
    requests:
      memory: 64Mi
      cpu: 50m
    limits:
      memory: 128Mi
      cpu: 100m
  
  # Environment configuration for frontend (if needed)
  env:
    # API endpoint configuration
    apiUrl: http://backend-api:5000
    nodeEnv: production

# PostgreSQL database configuration
postgres:
  enabled: true
  replicas: 1
  
  image:
    repository: postgres
    tag: 16-alpine
    pullPolicy: IfNotPresent
  
  service:
    name: postgres-service
    port: 5432
  
  # Database credentials (in production, use external secrets!)
  database:
    name: chatapp
    user: chatuser
    password: chatpass  # TODO: Move to Kubernetes Secret
  
  # Environment configuration for postgres
  env:
    postgresDb: chatapp
    postgresUser: chatuser
    pgdata: /var/lib/postgresql/data/pgdata
  
  # ConfigMap configuration
  configMap:
    name: postgres-config
    create: true

  # Persistent storage
  persistence:
    enabled: true
    size: 1Gi
    storageClass: ""

# Redis cache configuration
redis:
  enabled: true
  replicas: 1
  
  image:
    repository: redis
    tag: 7-alpine
    pullPolicy: IfNotPresent
  
  service:
    name: cache
    port: 6379
  
  resources:
    requests:
      memory: 64Mi
      cpu: 50m
    limits:
      memory: 128Mi
      cpu: 100m
  
  # Environment configuration for redis (if needed)
  env: {}  # Redis typically needs no env vars
  
  # ConfigMap configuration
  configMap:
    name: redis-config
    create: false  # Redis doesn't need ConfigMap

# RabbitMQ message queue configuration
rabbitmq:
  enabled: true
  replicas: 1
  
  image:
    repository: rabbitmq
    tag: 3-management-alpine
    pullPolicy: IfNotPresent
  
  service:
    name: message-queue
    amqpPort: 5672
    managementPort: 15672
  
  # Default credentials (in production, use Kubernetes Secret!)
  auth:
    username: guest
    password: guest  # TODO: Move to Kubernetes Secret
  
  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m
  
  # Environment configuration for rabbitmq
  env:
    rabbitmqDefaultUser: guest
    rabbitmqDefaultPass: guest
  
  # ConfigMap configuration
  configMap:
    name: rabbitmq-config
    create: true

# =========================================
# SECRETS CONFIGURATION
# =========================================
secrets:
  enabled: true
  dbPassword: "chatpass"
  secretKey: "your-secret-key-here"
  rabbitmqPassword: "guest"
  
  # =========================================
  # Docker Hub Registry Credentials
  # =========================================
  dockerhub:
    enabled: true
    secretName: "dockerhub-secret"
    config: "eyJhdXRocyI6eyJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOnsidXNlcm5hbWUiOiJ0b21lcm5vcyIsInBhc3N3b3JkIjoiZGNrcl9wYXRfc3lmV2RoM3hxdTlkWG90RGFtUnoxdU1TYmhRIiwiZW1haWwiOiJ0b21lcm5vczFAZW1haWwuY29tIiwiYXV0aCI6ImRHOXRaWEp1YjNNNlpHTnJjbDl3WVhSZmMzbG1WMlJvTTNoeGRUbGtXRzkwUkdGdFVub3hkVTFUWW1oUiJ9fX0="  # Leave empty to auto-generate from username/password
