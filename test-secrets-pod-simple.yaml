---
apiVersion: v1
kind: Pod
metadata:
  name: test-secrets-pod-simple
  namespace: chatapp-prod
spec:
  serviceAccountName: chatapp-sa
  containers:
  - name: test-app
    image: nginx:alpine
    command: ["/bin/sh", "-c"]
    args:
    - |
      echo "Waiting for secrets..."
      sleep 10
      echo "Checking mounted secrets:"
      ls -la /mnt/secrets/ || echo "No files"
      if [ -f /mnt/secrets/chatapp/test-secret ]; then
        echo "Secret content:"
        cat /mnt/secrets/chatapp/test-secret
      fi
      sleep 3600
    volumeMounts:
    - name: secrets-store
      mountPath: "/mnt/secrets"
      readOnly: true
  volumes:
  - name: secrets-store
    csi:
      driver: secrets-store.csi.k8s.io
      readOnly: true
      volumeAttributes:
        secretProviderClass: "chatapp-test-secrets-simple"
